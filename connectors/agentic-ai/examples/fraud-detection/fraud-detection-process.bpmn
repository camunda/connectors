<?xml version="1.0" encoding="UTF-8"?>
<bpmn:definitions xmlns:bpmn="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:dc="http://www.omg.org/spec/DD/20100524/DC" xmlns:zeebe="http://camunda.org/schema/zeebe/1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:di="http://www.omg.org/spec/DD/20100524/DI" xmlns:bioc="http://bpmn.io/schema/bpmn/biocolor/1.0" xmlns:color="http://www.omg.org/spec/BPMN/non-normative/color/1.0" xmlns:modeler="http://camunda.org/schema/modeler/1.0" id="Definitions_1" targetNamespace="http://bpmn.io/schema/bpmn" exporter="Camunda Modeler" exporterVersion="5.35.0" modeler:executionPlatform="Camunda Cloud" modeler:executionPlatformVersion="8.8.0">
  <bpmn:process id="fraud-detection-process" name="Fraud Detection Process" isExecutable="true">
    <bpmn:adHocSubProcess id="Fraud_Tools" name="Agent Tools/Actions">
      <bpmn:extensionElements>
        <zeebe:adHoc activeElementsCollection="=[toolCall._meta.name]" />
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_06sbwe8</bpmn:incoming>
      <bpmn:outgoing>Flow_1dc12gc</bpmn:outgoing>
      <bpmn:multiInstanceLoopCharacteristics>
        <bpmn:extensionElements>
          <zeebe:loopCharacteristics inputCollection="=agent.toolCalls" inputElement="toolCall" outputCollection="toolCallResults" outputElement="={&#10;  id: toolCall._meta.id,&#10;  name: toolCall._meta.name,&#10;  content: toolCallResult&#10;}" />
        </bpmn:extensionElements>
      </bpmn:multiInstanceLoopCharacteristics>
      <bpmn:userTask id="CallOnExternalAdvisor" name="Call On External Advisor">
        <bpmn:documentation>Ask a human expert to assist in the fraud detection.</bpmn:documentation>
        <bpmn:extensionElements>
          <zeebe:userTask />
          <zeebe:formDefinition formId="fraud-detection-process-view-tax-details" />
          <zeebe:ioMapping>
            <zeebe:input source="=fromAi(toolCall.taxSubmission, &#34;Summarize the tax submission which was provided by the user&#34;)" target="taxSubmission" />
            <zeebe:input source="=fromAi(toolCall.tendency, &#34;Share youre thoughts and tendency if this is fraud or not. This should help the expert getting a conclusion.&#34;)" target="tendency" />
            <zeebe:input source="=fromAi(toolCall.suspiciousParts, &#34;Parts of the tax submission you think are suspicious&#34;)" target="suspiciousParts" />
            <zeebe:output source="={&#10;  fraudDetected: fraudDetected,&#10;  expertAnalysis: expertAnalysis&#10;}" target="toolCallResult" />
          </zeebe:ioMapping>
        </bpmn:extensionElements>
        <bpmn:outgoing>Flow_02dr109</bpmn:outgoing>
      </bpmn:userTask>
      <bpmn:sequenceFlow id="Flow_02dr109" sourceRef="CallOnExternalAdvisor" targetRef="Gateway_04sl072" />
      <bpmn:sequenceFlow id="Flow_1plqcas" sourceRef="FraudDetected" targetRef="Event_0gnk722" />
      <bpmn:intermediateThrowEvent id="FraudDetected" name="Fraud! Detected">
        <bpmn:documentation>Use this tool to mark the submission as definitely being fraud.</bpmn:documentation>
        <bpmn:extensionElements>
          <zeebe:ioMapping>
            <zeebe:output source="=true" target="fraudDetected" />
            <zeebe:output source="=fromAi(toolCall.agentAnalysis, &#34;Final analysis why the submission is definitely fraud&#34;)" target="agentAnalysis" />
          </zeebe:ioMapping>
        </bpmn:extensionElements>
        <bpmn:outgoing>Flow_1plqcas</bpmn:outgoing>
      </bpmn:intermediateThrowEvent>
      <bpmn:serviceTask id="EmailInquiry" name="Generate Email Inquiry" zeebe:modelerTemplate="io.camunda.connectors.OpenAI.v1" zeebe:modelerTemplateVersion="5" zeebe:modelerTemplateIcon="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB3aWR0aD0iMjU2cHgiIGhlaWdodD0iMjYwcHgiIHZpZXdCb3g9IjAgMCAyNTYgMjYwIiB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHByZXNlcnZlQXNwZWN0UmF0aW89InhNaWRZTWlkIj4KICAgIDx0aXRsZT5PcGVuQUk8L3RpdGxlPgogICAgPGc+CiAgICAgICAgPHBhdGggZD0iTTIzOS4xODM5MTQsMTA2LjIwMjc4MyBDMjQ1LjA1NDMwNCw4OC41MjQyMDk2IDI0My4wMjIyOCw2OS4xNzMzODA1IDIzMy42MDc1OTksNTMuMDk5ODg2NCBDMjE5LjQ1MTY3OCwyOC40NTg4MDIxIDE5MC45OTk3MDMsMTUuNzgzNjEyOSAxNjMuMjEzMDA3LDIxLjczOTUwNSBDMTQ3LjU1NDA3Nyw0LjMyMTQ1ODgzIDEyMy43OTQ5MDksLTMuNDIzOTg1NTQgMTAwLjg3OTAxLDEuNDE4NzM4OTggQzc3Ljk2MzExMDUsNi4yNjE0NjM0OSA1OS4zNjkwMDkzLDIyLjk1NzI1MzYgNTIuMDk1OTYyMSw0NS4yMjE0MjE5IEMzMy44NDM2NDk0LDQ4Ljk2NDQ4NjcgMTguMDkwMTcyMSw2MC4zOTI3NDkgOC44NjY3MjUxMyw3Ni41ODE4MDMzIEMtNS40NDM0OTEsMTAxLjE4Mjk2MiAtMi4xOTU0NDQzMSwxMzIuMjE1MjU1IDE2Ljg5ODY2NjIsMTUzLjMyMDA5NCBDMTEuMDA2MDg2NSwxNzAuOTkwNjU2IDEzLjAxOTcyODMsMTkwLjM0Mzk5MSAyMi40MjM4MjMxLDIwNi40MjI5OTEgQzM2LjU5NzU1NTMsMjMxLjA3MjM0NCA2NS4wNjgwMzQyLDI0My43NDY1NjYgOTIuODY5NTczOCwyMzcuNzgzMzcyIEMxMDUuMjM1NjM5LDI1MS43MDgyNDkgMTIzLjAwMTExMywyNTkuNjMwOTQyIDE0MS42MjM5NjgsMjU5LjUyNjkyIEMxNzAuMTA1MzU5LDI1OS41NTIxNjkgMTk1LjMzNzYxMSwyNDEuMTY1NzE4IDIwNC4wMzc3NzcsMjE0LjA0NTY2MSBDMjIyLjI4NzM0LDIxMC4yOTYzNTYgMjM4LjAzODQ4OSwxOTguODY5NzgzIDI0Ny4yNjcwMTQsMTgyLjY4NTI4IEMyNjEuNDA0NDUzLDE1OC4xMjc1MTUgMjU4LjE0MjQ5NCwxMjcuMjYyNzc1IDIzOS4xODM5MTQsMTA2LjIwMjc4MyBMMjM5LjE4MzkxNCwxMDYuMjAyNzgzIFogTTE0MS42MjM5NjgsMjQyLjU0MTIwNyBDMTMwLjI1NTY4MiwyNDIuNTU5MTc3IDExOS4yNDM4NzYsMjM4LjU3NDY0MiAxMTAuNTE5MzgxLDIzMS4yODYxOTcgTDExMi4wNTQxNDYsMjMwLjQxNjQ5NiBMMTYzLjcyNDU5NSwyMDAuNTkwODgxIEMxNjYuMzQwNjQ4LDE5OS4wNTY0NDQgMTY3Ljk1NDMyMSwxOTYuMjU2ODE4IDE2Ny45NzA3ODEsMTkzLjIyNDAwNSBMMTY3Ljk3MDc4MSwxMjAuMzczNzg4IEwxODkuODE1NjE0LDEzMy4wMTAwMjYgQzE5MC4wMzQxMzIsMTMzLjEyMTQyMyAxOTAuMTg2MjM1LDEzMy4zMzA1NjQgMTkwLjIyNDg4NSwxMzMuNTcyNzc0IEwxOTAuMjI0ODg1LDE5My45NDAyMjkgQzE5MC4xNjg2MDMsMjIwLjc1ODQyNyAxNjguNDQyMTY2LDI0Mi40ODQ4NjQgMTQxLjYyMzk2OCwyNDIuNTQxMjA3IFogTTM3LjE1NzU3NDksMTk3LjkzMDYyIEMzMS40NTY0OTgsMTg4LjA4NjM1OSAyOS40MDk0ODE4LDE3Ni41NDY5ODQgMzEuMzc2NjIzNywxNjUuMzQyNDI2IEwzMi45MTEzODk1LDE2Ni4yNjMyODUgTDg0LjYzMjk5NzMsMTk2LjA4ODkwMSBDODcuMjM4OTM0OSwxOTcuNjE4MjA3IDkwLjQ2ODI3MTcsMTk3LjYxODIwNyA5My4wNzQyMDkzLDE5Ni4wODg5MDEgTDE1Ni4yNTU0MDIsMTU5LjY2Mzc5MyBMMTU2LjI1NTQwMiwxODQuODg1MTExIEMxNTYuMjQzNTU3LDE4NS4xNDk3NzEgMTU2LjExMTcyNSwxODUuMzk0NjAyIDE1NS44OTcyOSwxODUuNTUwMTc2IEwxMDMuNTYxNzc2LDIxNS43MzM5MDMgQzgwLjMwNTQ5NTMsMjI5LjEzMTYzMiA1MC41OTI0OTU0LDIyMS4xNjU0MzUgMzcuMTU3NTc0OSwxOTcuOTMwNjIgWiBNMjMuNTQ5MzE4MSw4NS4zODExMjczIEMyOS4yODk5ODYxLDc1LjQ3MzMwOTcgMzguMzUxMTkxMSw2Ny45MTYyNjQ4IDQ5LjEyODc0ODIsNjQuMDQ3ODgyNSBMNDkuMTI4NzQ4MiwxMjUuNDM4NTE1IEM0OS4wODkxNDkyLDEyOC40NTk0MjUgNTAuNjk2NTM4NiwxMzEuMjYyNTU2IDUzLjMyMzc3NDgsMTMyLjc1NDIzMiBMMTE2LjE5ODAxNCwxNjkuMDI1ODY0IEw5NC4zNTMxODA4LDE4MS42NjIxMDIgQzk0LjExMzIzMjUsMTgxLjc4OTQzNCA5My44MjU3NDYxLDE4MS43ODk0MzQgOTMuNTg1Nzk3OSwxODEuNjYyMTAyIEw0MS4zNTI2MDE1LDE1MS41Mjk1MzQgQzE4LjE0MTk0MjYsMTM4LjA3NjA5OCAxMC4xODE3NjgxLDEwOC4zODU1NjIgMjMuNTQ5MzE4MSw4NS4xMjUzMzMgTDIzLjU0OTMxODEsODUuMzgxMTI3MyBaIE0yMDMuMDE0NiwxMjcuMDc1NTk4IEwxMzkuOTM1NzI1LDkwLjQ0NTg1NDUgTDE2MS43Mjk0LDc3Ljg2MDc3NDggQzE2MS45NjkzNDgsNzcuNzMzNDQzNCAxNjIuMjU2ODM0LDc3LjczMzQ0MzQgMTYyLjQ5Njc4Myw3Ny44NjA3NzQ4IEwyMTQuNzI5OTc5LDEwOC4wNDQ1MDIgQzIzMS4wMzIzMjksMTE3LjQ1MTc0NyAyNDAuNDM3Mjk0LDEzNS40MjYxMDkgMjM4Ljg3MTUwNCwxNTQuMTgyNzM5IEMyMzcuMzA1NzE0LDE3Mi45MzkzNjggMjI1LjA1MDcxOSwxODkuMTA1NTcyIDIwNy40MTQyNjIsMTk1LjY3OTYzIEwyMDcuNDE0MjYyLDEzNC4yODg5OTggQzIwNy4zMjI1MjEsMTMxLjI3Njg2NyAyMDUuNjUwNjk3LDEyOC41MzU4NTMgMjAzLjAxNDYsMTI3LjA3NTU5OCBaIE0yMjQuNzU3MTE2LDk0LjM4NTA4NjcgTDIyMy4yMjIzNSw5My40NjQyMjcyIEwxNzEuNjAzMDYsNjMuMzgyODE3MyBDMTY4Ljk4MTI5Myw2MS44NDQzNzUxIDE2NS43MzI0NTYsNjEuODQ0Mzc1MSAxNjMuMTEwNjg5LDYzLjM4MjgxNzMgTDk5Ljk4MDY1NTQsOTkuODA3OTI1OSBMOTkuOTgwNjU1NCw3NC41ODY2MDc3IEM5OS45NTMzMDA0LDc0LjMyNTQwODggMTAwLjA3MTA5NSw3NC4wNzAxODY5IDEwMC4yODc2MDksNzMuOTIxNTQyNiBMMTUyLjUyMDgwNSw0My43ODg5NzM4IEMxNjguODYzMDk4LDM0LjM3NDM1MTggMTg5LjE3NDI1NiwzNS4yNTI5MDQzIDIwNC42NDI1NzksNDYuMDQzNDg0MSBDMjIwLjExMDkwMyw1Ni44MzQwNjM4IDIyNy45NDkyNjksNzUuNTkyMzk1OSAyMjQuNzU3MTE2LDk0LjE4MDQ1MTMgTDIyNC43NTcxMTYsOTQuMzg1MDg2NyBaIE04OC4wNjA2NDA5LDEzOS4wOTc5MzEgTDY2LjIxNTgwNzYsMTI2LjUxMjg1MSBDNjUuOTk1MDM5OSwxMjYuMzc5MDkxIDY1Ljg0NTA5NjUsMTI2LjE1NDE3NiA2NS44MDY1MzY3LDEyNS44OTg5NDUgTDY1LjgwNjUzNjcsNjUuNjg0OTY2IEM2NS44MzE0NDk1LDQ2LjgyODUzNjcgNzYuNzUwMDYwNSwyOS42ODQ2MDMyIDkzLjgyNzA4NTIsMjEuNjg4MzA1NSBDMTEwLjkwNDExLDEzLjY5MjAwNzkgMTMxLjA2MzgzMywxNi4yODM1NDYyIDE0NS41NjMyLDI4LjMzODk5OCBMMTQ0LjAyODQzNCwyOS4yMDg2OTg2IEw5Mi4zNTc5ODUyLDU5LjAzNDMxNDIgQzg5Ljc0MTkzMjcsNjAuNTY4NzUxMyA4OC4xMjgyNTk3LDYzLjM2ODM3NjcgODguMTExNzk5OCw2Ni40MDExOTAxIEw4OC4wNjA2NDA5LDEzOS4wOTc5MzEgWiBNOTkuOTI5NDk2NSwxMTMuNTE4NSBMMTI4LjA2Njg3LDk3LjMwMTE0MTcgTDE1Ni4yNTU0MDIsMTEzLjUxODUgTDE1Ni4yNTU0MDIsMTQ1Ljk1MzIxOCBMMTI4LjE2OTE4NywxNjIuMTcwNTc3IEw5OS45ODA2NTU0LDE0NS45NTMyMTggTDk5LjkyOTQ5NjUsMTEzLjUxODUgWiIgZmlsbD0iIzAwMDAwMCI+PC9wYXRoPgogICAgPC9nPgo8L3N2Zz4K">
        <bpmn:documentation>Let an email expert system generate an email to clarify information from the tax submission. You don't need to focus on the actual email text, but to give all the neexed context to the expert system.</bpmn:documentation>
        <bpmn:extensionElements>
          <zeebe:taskDefinition type="io.camunda:http-json:1" />
          <zeebe:ioMapping>
            <zeebe:input source="bearer" target="authentication.type" />
            <zeebe:input source="{{secrets.OPENAI_API_KEY}}" target="authentication.token" />
            <zeebe:input source="=if is defined(internal_organization) and internal_organization != null then {&#34;Content-Type&#34;:&#34;application/json&#34;, &#34;OpenAI-Organization&#34;:internal_organization} else {&#34;Content-Type&#34;:&#34;application/json&#34;}" target="headers" />
            <zeebe:input source="chat" target="operation" />
            <zeebe:input source="post" target="method" />
            <zeebe:input source="https://api.openai.com/v1/chat/completions" target="url" />
            <zeebe:input source="gpt-3.5-turbo" target="internal_model" />
            <zeebe:input source="1" target="internal_temperature" />
            <zeebe:input source="You are an e-mail generator. If you need to create a signature, call yourself &#34;Tax Verifcation Authority&#34;." target="internal_systemMessage" />
            <zeebe:input source="=&#34;I&#39;d like you to generate an email inquiry to a user who submitted a tax form and where more clarification is needed. You will receive the initial submission and a rough outline on which points need to be clarified. Generate a polite e-mail text asking for the needed information. Return only the e-mail body, no additional messages.\n\n&#60;taxSubmission&#62;&#34; + fromAi(toolCall.taxSubmission, &#34;Summarize the tax submission which was provided by the user&#34;) + &#34;\n&#60;/taxSubmission&#62;\n&#60;whatToClarify&#62;\n&#34; + fromAi(toolCall.whatToClarify, &#34;Which parts of the tax submission need clarification. Make sure to insist in case the user did not provide the right information.&#34;) + &#34;\n&#60;/whatToClarify&#62;&#34;" target="internal_prompt" />
            <zeebe:input source="1" target="internal_choices" />
            <zeebe:input source="=append(concatenate(if is defined(internal_systemMessage) then [{&#34;role&#34;: &#34;system&#34;, &#34;content&#34;: internal_systemMessage}] else [], if is defined(internal_chatHistory) then internal_chatHistory else []), {&#34;role&#34;: &#34;user&#34;, &#34;content&#34;: internal_prompt})" target="internal_messages" />
            <zeebe:input source="={&#34;model&#34;: if is defined(internal_custom_model) then internal_custom_model else internal_model, &#34;messages&#34;: internal_messages, &#34;n&#34;: number(internal_choices), &#34;temperature&#34;: number(internal_temperature)}" target="body" />
            <zeebe:input source="30" target="connectionTimeoutInSeconds" />
          </zeebe:ioMapping>
          <zeebe:taskHeaders>
            <zeebe:header key="resultExpression" value="={&#10;  emailBody: response.body.choices[1].message.content&#10;}" />
          </zeebe:taskHeaders>
        </bpmn:extensionElements>
        <bpmn:outgoing>Flow_0uh3nkx</bpmn:outgoing>
      </bpmn:serviceTask>
      <bpmn:exclusiveGateway id="Gateway_04sl072" name="Is Fraud Detected?" default="Flow_1y3onm8">
        <bpmn:incoming>Flow_02dr109</bpmn:incoming>
        <bpmn:outgoing>Flow_1ex155v</bpmn:outgoing>
        <bpmn:outgoing>Flow_1y3onm8</bpmn:outgoing>
      </bpmn:exclusiveGateway>
      <bpmn:sequenceFlow id="Flow_1y3onm8" name="No" sourceRef="Gateway_04sl072" targetRef="Event_0ut60ps" />
      <bpmn:intermediateThrowEvent id="Event_0ut60ps" name="No Fraud!">
        <bpmn:extensionElements />
        <bpmn:incoming>Flow_1y3onm8</bpmn:incoming>
      </bpmn:intermediateThrowEvent>
      <bpmn:intermediateThrowEvent id="Event_0gnk722" name="Throw Fraud">
        <bpmn:extensionElements>
          <zeebe:ioMapping>
            <zeebe:output source="=toolCallResult.expertAnalysis" target="expertAnalysis" />
            <zeebe:output source="=agentAnalysis" target="agentAnalysis" />
          </zeebe:ioMapping>
        </bpmn:extensionElements>
        <bpmn:incoming>Flow_1plqcas</bpmn:incoming>
        <bpmn:incoming>Flow_1ex155v</bpmn:incoming>
        <bpmn:escalationEventDefinition id="EscalationEventDefinition_1a0n3ld" escalationRef="Escalation_3eekq60" />
      </bpmn:intermediateThrowEvent>
      <bpmn:sequenceFlow id="Flow_1ex155v" name="Yes" sourceRef="Gateway_04sl072" targetRef="Event_0gnk722">
        <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">=toolCallResult.fraudDetected</bpmn:conditionExpression>
      </bpmn:sequenceFlow>
      <bpmn:sequenceFlow id="Flow_0uh3nkx" sourceRef="EmailInquiry" targetRef="Activity_1yge9uw" />
      <bpmn:userTask id="Activity_087ozlu" name="User response">
        <bpmn:extensionElements>
          <zeebe:userTask />
          <zeebe:formDefinition formId="fraud-detection-process-send-email" />
          <zeebe:ioMapping>
            <zeebe:output source="={&#10;  userResponse: userResponse&#10;}" target="toolCallResult" />
          </zeebe:ioMapping>
        </bpmn:extensionElements>
        <bpmn:incoming>Flow_04fnx3s</bpmn:incoming>
      </bpmn:userTask>
      <bpmn:sequenceFlow id="Flow_04fnx3s" sourceRef="Activity_1yge9uw" targetRef="Activity_087ozlu" />
      <bpmn:task id="Activity_1yge9uw" name="Send e-mail">
        <bpmn:incoming>Flow_0uh3nkx</bpmn:incoming>
        <bpmn:outgoing>Flow_04fnx3s</bpmn:outgoing>
      </bpmn:task>
    </bpmn:adHocSubProcess>
    <bpmn:serviceTask id="RunFinalCheck" name="Run Final Check on Result" zeebe:modelerTemplate="io.camunda.connectors.OpenAI.v1" zeebe:modelerTemplateVersion="5" zeebe:modelerTemplateIcon="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB3aWR0aD0iMjU2cHgiIGhlaWdodD0iMjYwcHgiIHZpZXdCb3g9IjAgMCAyNTYgMjYwIiB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHByZXNlcnZlQXNwZWN0UmF0aW89InhNaWRZTWlkIj4KICAgIDx0aXRsZT5PcGVuQUk8L3RpdGxlPgogICAgPGc+CiAgICAgICAgPHBhdGggZD0iTTIzOS4xODM5MTQsMTA2LjIwMjc4MyBDMjQ1LjA1NDMwNCw4OC41MjQyMDk2IDI0My4wMjIyOCw2OS4xNzMzODA1IDIzMy42MDc1OTksNTMuMDk5ODg2NCBDMjE5LjQ1MTY3OCwyOC40NTg4MDIxIDE5MC45OTk3MDMsMTUuNzgzNjEyOSAxNjMuMjEzMDA3LDIxLjczOTUwNSBDMTQ3LjU1NDA3Nyw0LjMyMTQ1ODgzIDEyMy43OTQ5MDksLTMuNDIzOTg1NTQgMTAwLjg3OTAxLDEuNDE4NzM4OTggQzc3Ljk2MzExMDUsNi4yNjE0NjM0OSA1OS4zNjkwMDkzLDIyLjk1NzI1MzYgNTIuMDk1OTYyMSw0NS4yMjE0MjE5IEMzMy44NDM2NDk0LDQ4Ljk2NDQ4NjcgMTguMDkwMTcyMSw2MC4zOTI3NDkgOC44NjY3MjUxMyw3Ni41ODE4MDMzIEMtNS40NDM0OTEsMTAxLjE4Mjk2MiAtMi4xOTU0NDQzMSwxMzIuMjE1MjU1IDE2Ljg5ODY2NjIsMTUzLjMyMDA5NCBDMTEuMDA2MDg2NSwxNzAuOTkwNjU2IDEzLjAxOTcyODMsMTkwLjM0Mzk5MSAyMi40MjM4MjMxLDIwNi40MjI5OTEgQzM2LjU5NzU1NTMsMjMxLjA3MjM0NCA2NS4wNjgwMzQyLDI0My43NDY1NjYgOTIuODY5NTczOCwyMzcuNzgzMzcyIEMxMDUuMjM1NjM5LDI1MS43MDgyNDkgMTIzLjAwMTExMywyNTkuNjMwOTQyIDE0MS42MjM5NjgsMjU5LjUyNjkyIEMxNzAuMTA1MzU5LDI1OS41NTIxNjkgMTk1LjMzNzYxMSwyNDEuMTY1NzE4IDIwNC4wMzc3NzcsMjE0LjA0NTY2MSBDMjIyLjI4NzM0LDIxMC4yOTYzNTYgMjM4LjAzODQ4OSwxOTguODY5NzgzIDI0Ny4yNjcwMTQsMTgyLjY4NTI4IEMyNjEuNDA0NDUzLDE1OC4xMjc1MTUgMjU4LjE0MjQ5NCwxMjcuMjYyNzc1IDIzOS4xODM5MTQsMTA2LjIwMjc4MyBMMjM5LjE4MzkxNCwxMDYuMjAyNzgzIFogTTE0MS42MjM5NjgsMjQyLjU0MTIwNyBDMTMwLjI1NTY4MiwyNDIuNTU5MTc3IDExOS4yNDM4NzYsMjM4LjU3NDY0MiAxMTAuNTE5MzgxLDIzMS4yODYxOTcgTDExMi4wNTQxNDYsMjMwLjQxNjQ5NiBMMTYzLjcyNDU5NSwyMDAuNTkwODgxIEMxNjYuMzQwNjQ4LDE5OS4wNTY0NDQgMTY3Ljk1NDMyMSwxOTYuMjU2ODE4IDE2Ny45NzA3ODEsMTkzLjIyNDAwNSBMMTY3Ljk3MDc4MSwxMjAuMzczNzg4IEwxODkuODE1NjE0LDEzMy4wMTAwMjYgQzE5MC4wMzQxMzIsMTMzLjEyMTQyMyAxOTAuMTg2MjM1LDEzMy4zMzA1NjQgMTkwLjIyNDg4NSwxMzMuNTcyNzc0IEwxOTAuMjI0ODg1LDE5My45NDAyMjkgQzE5MC4xNjg2MDMsMjIwLjc1ODQyNyAxNjguNDQyMTY2LDI0Mi40ODQ4NjQgMTQxLjYyMzk2OCwyNDIuNTQxMjA3IFogTTM3LjE1NzU3NDksMTk3LjkzMDYyIEMzMS40NTY0OTgsMTg4LjA4NjM1OSAyOS40MDk0ODE4LDE3Ni41NDY5ODQgMzEuMzc2NjIzNywxNjUuMzQyNDI2IEwzMi45MTEzODk1LDE2Ni4yNjMyODUgTDg0LjYzMjk5NzMsMTk2LjA4ODkwMSBDODcuMjM4OTM0OSwxOTcuNjE4MjA3IDkwLjQ2ODI3MTcsMTk3LjYxODIwNyA5My4wNzQyMDkzLDE5Ni4wODg5MDEgTDE1Ni4yNTU0MDIsMTU5LjY2Mzc5MyBMMTU2LjI1NTQwMiwxODQuODg1MTExIEMxNTYuMjQzNTU3LDE4NS4xNDk3NzEgMTU2LjExMTcyNSwxODUuMzk0NjAyIDE1NS44OTcyOSwxODUuNTUwMTc2IEwxMDMuNTYxNzc2LDIxNS43MzM5MDMgQzgwLjMwNTQ5NTMsMjI5LjEzMTYzMiA1MC41OTI0OTU0LDIyMS4xNjU0MzUgMzcuMTU3NTc0OSwxOTcuOTMwNjIgWiBNMjMuNTQ5MzE4MSw4NS4zODExMjczIEMyOS4yODk5ODYxLDc1LjQ3MzMwOTcgMzguMzUxMTkxMSw2Ny45MTYyNjQ4IDQ5LjEyODc0ODIsNjQuMDQ3ODgyNSBMNDkuMTI4NzQ4MiwxMjUuNDM4NTE1IEM0OS4wODkxNDkyLDEyOC40NTk0MjUgNTAuNjk2NTM4NiwxMzEuMjYyNTU2IDUzLjMyMzc3NDgsMTMyLjc1NDIzMiBMMTE2LjE5ODAxNCwxNjkuMDI1ODY0IEw5NC4zNTMxODA4LDE4MS42NjIxMDIgQzk0LjExMzIzMjUsMTgxLjc4OTQzNCA5My44MjU3NDYxLDE4MS43ODk0MzQgOTMuNTg1Nzk3OSwxODEuNjYyMTAyIEw0MS4zNTI2MDE1LDE1MS41Mjk1MzQgQzE4LjE0MTk0MjYsMTM4LjA3NjA5OCAxMC4xODE3NjgxLDEwOC4zODU1NjIgMjMuNTQ5MzE4MSw4NS4xMjUzMzMgTDIzLjU0OTMxODEsODUuMzgxMTI3MyBaIE0yMDMuMDE0NiwxMjcuMDc1NTk4IEwxMzkuOTM1NzI1LDkwLjQ0NTg1NDUgTDE2MS43Mjk0LDc3Ljg2MDc3NDggQzE2MS45NjkzNDgsNzcuNzMzNDQzNCAxNjIuMjU2ODM0LDc3LjczMzQ0MzQgMTYyLjQ5Njc4Myw3Ny44NjA3NzQ4IEwyMTQuNzI5OTc5LDEwOC4wNDQ1MDIgQzIzMS4wMzIzMjksMTE3LjQ1MTc0NyAyNDAuNDM3Mjk0LDEzNS40MjYxMDkgMjM4Ljg3MTUwNCwxNTQuMTgyNzM5IEMyMzcuMzA1NzE0LDE3Mi45MzkzNjggMjI1LjA1MDcxOSwxODkuMTA1NTcyIDIwNy40MTQyNjIsMTk1LjY3OTYzIEwyMDcuNDE0MjYyLDEzNC4yODg5OTggQzIwNy4zMjI1MjEsMTMxLjI3Njg2NyAyMDUuNjUwNjk3LDEyOC41MzU4NTMgMjAzLjAxNDYsMTI3LjA3NTU5OCBaIE0yMjQuNzU3MTE2LDk0LjM4NTA4NjcgTDIyMy4yMjIzNSw5My40NjQyMjcyIEwxNzEuNjAzMDYsNjMuMzgyODE3MyBDMTY4Ljk4MTI5Myw2MS44NDQzNzUxIDE2NS43MzI0NTYsNjEuODQ0Mzc1MSAxNjMuMTEwNjg5LDYzLjM4MjgxNzMgTDk5Ljk4MDY1NTQsOTkuODA3OTI1OSBMOTkuOTgwNjU1NCw3NC41ODY2MDc3IEM5OS45NTMzMDA0LDc0LjMyNTQwODggMTAwLjA3MTA5NSw3NC4wNzAxODY5IDEwMC4yODc2MDksNzMuOTIxNTQyNiBMMTUyLjUyMDgwNSw0My43ODg5NzM4IEMxNjguODYzMDk4LDM0LjM3NDM1MTggMTg5LjE3NDI1NiwzNS4yNTI5MDQzIDIwNC42NDI1NzksNDYuMDQzNDg0MSBDMjIwLjExMDkwMyw1Ni44MzQwNjM4IDIyNy45NDkyNjksNzUuNTkyMzk1OSAyMjQuNzU3MTE2LDk0LjE4MDQ1MTMgTDIyNC43NTcxMTYsOTQuMzg1MDg2NyBaIE04OC4wNjA2NDA5LDEzOS4wOTc5MzEgTDY2LjIxNTgwNzYsMTI2LjUxMjg1MSBDNjUuOTk1MDM5OSwxMjYuMzc5MDkxIDY1Ljg0NTA5NjUsMTI2LjE1NDE3NiA2NS44MDY1MzY3LDEyNS44OTg5NDUgTDY1LjgwNjUzNjcsNjUuNjg0OTY2IEM2NS44MzE0NDk1LDQ2LjgyODUzNjcgNzYuNzUwMDYwNSwyOS42ODQ2MDMyIDkzLjgyNzA4NTIsMjEuNjg4MzA1NSBDMTEwLjkwNDExLDEzLjY5MjAwNzkgMTMxLjA2MzgzMywxNi4yODM1NDYyIDE0NS41NjMyLDI4LjMzODk5OCBMMTQ0LjAyODQzNCwyOS4yMDg2OTg2IEw5Mi4zNTc5ODUyLDU5LjAzNDMxNDIgQzg5Ljc0MTkzMjcsNjAuNTY4NzUxMyA4OC4xMjgyNTk3LDYzLjM2ODM3NjcgODguMTExNzk5OCw2Ni40MDExOTAxIEw4OC4wNjA2NDA5LDEzOS4wOTc5MzEgWiBNOTkuOTI5NDk2NSwxMTMuNTE4NSBMMTI4LjA2Njg3LDk3LjMwMTE0MTcgTDE1Ni4yNTU0MDIsMTEzLjUxODUgTDE1Ni4yNTU0MDIsMTQ1Ljk1MzIxOCBMMTI4LjE2OTE4NywxNjIuMTcwNTc3IEw5OS45ODA2NTU0LDE0NS45NTMyMTggTDk5LjkyOTQ5NjUsMTEzLjUxODUgWiIgZmlsbD0iIzAwMDAwMCI+PC9wYXRoPgogICAgPC9nPgo8L3N2Zz4K">
      <bpmn:extensionElements>
        <zeebe:taskDefinition type="io.camunda:http-json:1" />
        <zeebe:ioMapping>
          <zeebe:input source="bearer" target="authentication.type" />
          <zeebe:input source="{{secrets.OPENAI_API_KEY}}" target="authentication.token" />
          <zeebe:input source="=if is defined(internal_organization) and internal_organization != null then {&#34;Content-Type&#34;:&#34;application/json&#34;, &#34;OpenAI-Organization&#34;:internal_organization} else {&#34;Content-Type&#34;:&#34;application/json&#34;}" target="headers" />
          <zeebe:input source="chat" target="operation" />
          <zeebe:input source="post" target="method" />
          <zeebe:input source="https://api.openai.com/v1/chat/completions" target="url" />
          <zeebe:input source="gpt-4o" target="internal_model" />
          <zeebe:input source="1" target="internal_temperature" />
          <zeebe:input source="You are verifying the decision of a fraud detection process based on a tax submission. You will receive a conversation history with another model as input and need to decide if you agree with this submission being valid. &#10;&#10;If you decide the submission is no fraud, simply answer with &#39;yes&#39; (no quotes, tags or other text).&#10;&#10;If you think it can still be fraud, answer with your suggestion in &#60;fraudVerification&#62;&#60;/fraudVerification&#62; tags." target="internal_systemMessage" />
          <zeebe:input source="=&#34;&#60;history&#62;&#34; + string(agent.context.conversation.messages) + &#34;&#60;/history&#62;&#34;" target="internal_prompt" />
          <zeebe:input source="1" target="internal_choices" />
          <zeebe:input source="=append(concatenate(if is defined(internal_systemMessage) then [{&#34;role&#34;: &#34;system&#34;, &#34;content&#34;: internal_systemMessage}] else [], if is defined(internal_chatHistory) then internal_chatHistory else []), {&#34;role&#34;: &#34;user&#34;, &#34;content&#34;: internal_prompt})" target="internal_messages" />
          <zeebe:input source="={&#34;model&#34;: if is defined(internal_custom_model) then internal_custom_model else internal_model, &#34;messages&#34;: internal_messages, &#34;n&#34;: number(internal_choices), &#34;temperature&#34;: number(internal_temperature)}" target="body" />
          <zeebe:input source="30" target="connectionTimeoutInSeconds" />
        </zeebe:ioMapping>
        <zeebe:taskHeaders>
          <zeebe:header key="resultExpression" value="={&#10;  finalCheck: response.body.choices[1].message.content&#10;}" />
        </zeebe:taskHeaders>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_0fo3u1d</bpmn:incoming>
      <bpmn:outgoing>Flow_0nriff3</bpmn:outgoing>
    </bpmn:serviceTask>
    <bpmn:exclusiveGateway id="Gateway_0y12zon" name="Decision Made?" default="Flow_1yea5o1">
      <bpmn:incoming>Flow_0nriff3</bpmn:incoming>
      <bpmn:outgoing>Flow_1dqcrtw</bpmn:outgoing>
      <bpmn:outgoing>Flow_1yea5o1</bpmn:outgoing>
    </bpmn:exclusiveGateway>
    <bpmn:startEvent id="StartEvent_1" name="Enter Details of Tax">
      <bpmn:extensionElements>
        <zeebe:formDefinition formId="fraud-detection-process-enter-tax-form" />
        <zeebe:properties>
          <zeebe:property name="camundaModeler:exampleOutputJson" value="{&#34;taxSubmission&#34;: {&#34;fullName&#34;:&#34;John Smith&#34;,&#34;dob&#34;:&#34;1980-04-05&#34;,&#34;emailAddress&#34;:&#34;johnny.s@gmail.com&#34;,&#34;totalIncome&#34;:70000,&#34;totalExpenses&#34;:3500,&#34;largePurchases&#34;:[&#34;stocks&#34;],&#34;charitableDonations&#34;:&#34;I gave 5€ to a homeless man.&#34;}}" />
        </zeebe:properties>
      </bpmn:extensionElements>
      <bpmn:outgoing>Flow_0ifqrnr</bpmn:outgoing>
    </bpmn:startEvent>
    <bpmn:sequenceFlow id="Flow_06y8gt9" sourceRef="Gateway_0cttbk8" targetRef="FraudDetectionAgent" />
    <bpmn:sequenceFlow id="Flow_0ifqrnr" sourceRef="StartEvent_1" targetRef="Gateway_0cttbk8" />
    <bpmn:sequenceFlow id="Flow_0nriff3" sourceRef="RunFinalCheck" targetRef="Gateway_0y12zon" />
    <bpmn:sequenceFlow id="Flow_0udscr6" sourceRef="Event_01me1b4" targetRef="Event_1sxkleb" />
    <bpmn:endEvent id="Event_1sxkleb" name="Fraud is detected">
      <bpmn:incoming>Flow_0udscr6</bpmn:incoming>
    </bpmn:endEvent>
    <bpmn:exclusiveGateway id="Gateway_0cttbk8">
      <bpmn:incoming>Flow_1yea5o1</bpmn:incoming>
      <bpmn:incoming>Flow_1dc12gc</bpmn:incoming>
      <bpmn:incoming>Flow_0ifqrnr</bpmn:incoming>
      <bpmn:outgoing>Flow_06y8gt9</bpmn:outgoing>
    </bpmn:exclusiveGateway>
    <bpmn:sequenceFlow id="Flow_1yea5o1" name="No" sourceRef="Gateway_0y12zon" targetRef="Gateway_0cttbk8" />
    <bpmn:endEvent id="Event_0vgcvn8" name="No Fraud Detected">
      <bpmn:incoming>Flow_1dqcrtw</bpmn:incoming>
    </bpmn:endEvent>
    <bpmn:boundaryEvent id="Event_01me1b4" name="Throw Fraud" attachedToRef="Fraud_Tools">
      <bpmn:outgoing>Flow_0udscr6</bpmn:outgoing>
      <bpmn:escalationEventDefinition id="EscalationEventDefinition_12tppbv" escalationRef="Escalation_3eekq60" />
    </bpmn:boundaryEvent>
    <bpmn:sequenceFlow id="Flow_1dqcrtw" name="Yes" sourceRef="Gateway_0y12zon" targetRef="Event_0vgcvn8">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">=finalCheck = "yes"</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:serviceTask id="FraudDetectionAgent" name="Fraud detection agent" zeebe:modelerTemplate="io.camunda.connectors.agenticai.aiagent.v1" zeebe:modelerTemplateVersion="1" zeebe:modelerTemplateIcon="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAzMiAzMiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMTYiIGN5PSIxNiIgcj0iMTYiIGZpbGw9IiNBNTZFRkYiLz4KPG1hc2sgaWQ9InBhdGgtMi1vdXRzaWRlLTFfMTg1XzYiIG1hc2tVbml0cz0idXNlclNwYWNlT25Vc2UiIHg9IjQiIHk9IjQiIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgZmlsbD0iYmxhY2siPgo8cmVjdCBmaWxsPSJ3aGl0ZSIgeD0iNCIgeT0iNCIgd2lkdGg9IjI0IiBoZWlnaHQ9IjI0Ii8+CjxwYXRoIGZpbGwtcnVsZT0iZXZlbm9kZCIgY2xpcC1ydWxlPSJldmVub2RkIiBkPSJNMjAuMDEwNSAxMi4wOTg3QzE4LjQ5IDEwLjU4OTQgMTcuMTU5NCA4LjEwODE0IDE2LjE3OTkgNi4wMTEwM0MxNi4xNTIgNi4wMDQ1MSAxNi4xMTc2IDYgMTYuMDc5NCA2QzE2LjA0MTEgNiAxNi4wMDY2IDYuMDA0NTEgMTUuOTc4OCA2LjAxMTA0QzE0Ljk5OTQgOC4xMDgxNCAxMy42Njk3IDEwLjU4ODkgMTIuMTQ4MSAxMi4wOTgxQzEwLjYyNjkgMTMuNjA3MSA4LjEyNTY4IDE0LjkyNjQgNi4wMTE1NyAxNS44OTgxQzYuMDA0NzQgMTUuOTI2MSA2IDE1Ljk2MTEgNiAxNkM2IDE2LjAzODcgNi4wMDQ2OCAxNi4wNzM2IDYuMDExNDQgMTYuMTAxNEM4LjEyNTE5IDE3LjA3MjkgMTAuNjI2MiAxOC4zOTE5IDEyLjE0NzcgMTkuOTAxNkMxMy42Njk3IDIxLjQxMDcgMTQuOTk5NiAyMy44OTIgMTUuOTc5MSAyNS45ODlDMTYuMDA2OCAyNS45OTU2IDE2LjA0MTEgMjYgMTYuMDc5MyAyNkMxNi4xMTc1IDI2IDE2LjE1MTkgMjUuOTk1NCAxNi4xNzk2IDI1Ljk4OUMxNy4xNTkxIDIzLjg5MiAxOC40ODg4IDIxLjQxMSAyMC4wMDk5IDE5LjkwMjFNMjAuMDA5OSAxOS45MDIxQzIxLjUyNTMgMTguMzk4NyAyMy45NDY1IDE3LjA2NjkgMjUuOTkxNSAxNi4wODI0QzI1Ljk5NjUgMTYuMDU5MyAyNiAxNi4wMzEgMjYgMTUuOTk5N0MyNiAxNS45Njg0IDI1Ljk5NjUgMTUuOTQwMyAyNS45OTE1IDE1LjkxNzFDMjMuOTQ3NCAxNC45MzI3IDIxLjUyNTkgMTMuNjAxIDIwLjAxMDUgMTIuMDk4NyIvPgo8L21hc2s+CjxwYXRoIGZpbGwtcnVsZT0iZXZlbm9kZCIgY2xpcC1ydWxlPSJldmVub2RkIiBkPSJNMjAuMDEwNSAxMi4wOTg3QzE4LjQ5IDEwLjU4OTQgMTcuMTU5NCA4LjEwODE0IDE2LjE3OTkgNi4wMTEwM0MxNi4xNTIgNi4wMDQ1MSAxNi4xMTc2IDYgMTYuMDc5NCA2QzE2LjA0MTEgNiAxNi4wMDY2IDYuMDA0NTEgMTUuOTc4OCA2LjAxMTA0QzE0Ljk5OTQgOC4xMDgxNCAxMy42Njk3IDEwLjU4ODkgMTIuMTQ4MSAxMi4wOTgxQzEwLjYyNjkgMTMuNjA3MSA4LjEyNTY4IDE0LjkyNjQgNi4wMTE1NyAxNS44OTgxQzYuMDA0NzQgMTUuOTI2MSA2IDE1Ljk2MTEgNiAxNkM2IDE2LjAzODcgNi4wMDQ2OCAxNi4wNzM2IDYuMDExNDQgMTYuMTAxNEM4LjEyNTE5IDE3LjA3MjkgMTAuNjI2MiAxOC4zOTE5IDEyLjE0NzcgMTkuOTAxNkMxMy42Njk3IDIxLjQxMDcgMTQuOTk5NiAyMy44OTIgMTUuOTc5MSAyNS45ODlDMTYuMDA2OCAyNS45OTU2IDE2LjA0MTEgMjYgMTYuMDc5MyAyNkMxNi4xMTc1IDI2IDE2LjE1MTkgMjUuOTk1NCAxNi4xNzk2IDI1Ljk4OUMxNy4xNTkxIDIzLjg5MiAxOC40ODg4IDIxLjQxMSAyMC4wMDk5IDE5LjkwMjFNMjAuMDA5OSAxOS45MDIxQzIxLjUyNTMgMTguMzk4NyAyMy45NDY1IDE3LjA2NjkgMjUuOTkxNSAxNi4wODI0QzI1Ljk5NjUgMTYuMDU5MyAyNiAxNi4wMzEgMjYgMTUuOTk5N0MyNiAxNS45Njg0IDI1Ljk5NjUgMTUuOTQwMyAyNS45OTE1IDE1LjkxNzFDMjMuOTQ3NCAxNC45MzI3IDIxLjUyNTkgMTMuNjAxIDIwLjAxMDUgMTIuMDk4NyIgZmlsbD0id2hpdGUiLz4KPHBhdGggZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGQ9Ik0yMC4wMTA1IDEyLjA5ODdDMTguNDkgMTAuNTg5NCAxNy4xNTk0IDguMTA4MTQgMTYuMTc5OSA2LjAxMTAzQzE2LjE1MiA2LjAwNDUxIDE2LjExNzYgNiAxNi4wNzk0IDZDMTYuMDQxMSA2IDE2LjAwNjYgNi4wMDQ1MSAxNS45Nzg4IDYuMDExMDRDMTQuOTk5NCA4LjEwODE0IDEzLjY2OTcgMTAuNTg4OSAxMi4xNDgxIDEyLjA5ODFDMTAuNjI2OSAxMy42MDcxIDguMTI1NjggMTQuOTI2NCA2LjAxMTU3IDE1Ljg5ODFDNi4wMDQ3NCAxNS45MjYxIDYgMTUuOTYxMSA2IDE2QzYgMTYuMDM4NyA2LjAwNDY4IDE2LjA3MzYgNi4wMTE0NCAxNi4xMDE0QzguMTI1MTkgMTcuMDcyOSAxMC42MjYyIDE4LjM5MTkgMTIuMTQ3NyAxOS45MDE2QzEzLjY2OTcgMjEuNDEwNyAxNC45OTk2IDIzLjg5MiAxNS45NzkxIDI1Ljk4OUMxNi4wMDY4IDI1Ljk5NTYgMTYuMDQxMSAyNiAxNi4wNzkzIDI2QzE2LjExNzUgMjYgMTYuMTUxOSAyNS45OTU0IDE2LjE3OTYgMjUuOTg5QzE3LjE1OTEgMjMuODkyIDE4LjQ4ODggMjEuNDExIDIwLjAwOTkgMTkuOTAyMU0yMC4wMDk5IDE5LjkwMjFDMjEuNTI1MyAxOC4zOTg3IDIzLjk0NjUgMTcuMDY2OSAyNS45OTE1IDE2LjA4MjRDMjUuOTk2NSAxNi4wNTkzIDI2IDE2LjAzMSAyNiAxNS45OTk3QzI2IDE1Ljk2ODQgMjUuOTk2NSAxNS45NDAzIDI1Ljk5MTUgMTUuOTE3MUMyMy45NDc0IDE0LjkzMjcgMjEuNTI1OSAxMy42MDEgMjAuMDEwNSAxMi4wOTg3IiBzdHJva2U9IiM0OTFEOEIiIHN0cm9rZS13aWR0aD0iNCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgbWFzaz0idXJsKCNwYXRoLTItb3V0c2lkZS0xXzE4NV82KSIvPgo8L3N2Zz4K">
      <bpmn:extensionElements>
        <zeebe:taskDefinition type="io.camunda.agenticai:aiagent:1" retries="0" />
        <zeebe:ioMapping>
          <zeebe:input source="bedrock" target="provider.type" />
          <zeebe:input source="eu-central-1" target="provider.bedrock.region" />
          <zeebe:input source="credentials" target="provider.bedrock.authentication.type" />
          <zeebe:input source="{{secrets.AWS_BEDROCK_ACCESS_KEY}}" target="provider.bedrock.authentication.accessKey" />
          <zeebe:input source="{{secrets.AWS_BEDROCK_SECRET_KEY}}" target="provider.bedrock.authentication.secretKey" />
          <zeebe:input source="anthropic.claude-3-5-sonnet-20240620-v1:0" target="provider.bedrock.model.model" />
          <zeebe:input source="You are a fraud detection agent which needs to decide if a tax submission is fraud or not. You can decide on fraud right away and you can use a set of provided tools to gain more knowledge. &#10;&#10;You will receive the initial tax submission in &#60;taxSubmission&#62; tags and a follow up process might make suggestions on your decision which you should incorporate. If you detect a submission to be wildly wrong or a joke submission, directly flag it as fraud using the provided tool.&#10;&#10;You can call the same tool multiple times by providing different input values. Don&#39;t guess any tools which were not explicitely configured. If no tool matches the request, try to generate an answer. If you&#39;re not able to find a good answer, return with a message stating why you&#39;re not able to.&#10;&#10;Thinking, step by step, before you execute your tools, you think using the template `&#60;thinking&#62;&#60;context&#62;&#60;/context&#62;&#60;reflection&#62;&#60;/reflection&#62;&#60;/thinking&#62;`. When you are able to come to a decision, return it in a `&#60;fraudDecision&#62;&#60;fraud&#62;true|false&#60;/fraud&#62;&#60;verdict&#62;&#60;/verdict&#62;&#60;/fraudDecision&#62;` structure.&#10;&#10;The current date and time is: {{current_date_time}}" target="data.systemPrompt.prompt" />
          <zeebe:input source="=if (is defined(finalCheck)) then&#10;  finalCheck&#10;else &#34;&#60;taxSubmission&#62;&#34; + string(taxSubmission) + &#34;&#60;/taxSubmission&#62;&#34;" target="data.userPrompt.prompt" />
          <zeebe:input source="Fraud_Tools" target="data.tools.containerElementId" />
          <zeebe:input source="=toolCallResults" target="data.tools.toolCallResults" />
          <zeebe:input source="=agent.context" target="data.context" />
          <zeebe:input source="=20" target="data.memory.maxMessages" />
          <zeebe:input source="=20" target="data.limits.maxModelCalls" />
          <zeebe:input source="text" target="data.response.format.type" />
        </zeebe:ioMapping>
        <zeebe:taskHeaders>
          <zeebe:header key="elementTemplateVersion" value="1" />
          <zeebe:header key="elementTemplateId" value="io.camunda.connectors.agenticai.aiagent.v1" />
          <zeebe:header key="resultVariable" value="agent" />
          <zeebe:header key="retryBackoff" value="PT0S" />
        </zeebe:taskHeaders>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_06y8gt9</bpmn:incoming>
      <bpmn:outgoing>Flow_09px1dp</bpmn:outgoing>
    </bpmn:serviceTask>
    <bpmn:exclusiveGateway id="Gateway_0bukj01" name="Includes tool calls?" default="Flow_0fo3u1d">
      <bpmn:incoming>Flow_09px1dp</bpmn:incoming>
      <bpmn:outgoing>Flow_06sbwe8</bpmn:outgoing>
      <bpmn:outgoing>Flow_0fo3u1d</bpmn:outgoing>
    </bpmn:exclusiveGateway>
    <bpmn:sequenceFlow id="Flow_06sbwe8" sourceRef="Gateway_0bukj01" targetRef="Fraud_Tools">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">=not(is empty(agent.toolCalls))</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:sequenceFlow id="Flow_09px1dp" sourceRef="FraudDetectionAgent" targetRef="Gateway_0bukj01" />
    <bpmn:sequenceFlow id="Flow_1dc12gc" sourceRef="Fraud_Tools" targetRef="Gateway_0cttbk8" />
    <bpmn:sequenceFlow id="Flow_0fo3u1d" sourceRef="Gateway_0bukj01" targetRef="RunFinalCheck" />
    <bpmn:scriptTask id="Check_Fraud_Database" name="Check Fraud Database">
      <bpmn:documentation>Consult the fraud database to check if the person is known as fradulent. If this returns FRAUD, the tax submission can be directly categorized as fraud.</bpmn:documentation>
      <bpmn:extensionElements>
        <zeebe:script expression="=if taxSubmission.emailAddress = &#34;johnny.s@gmail.com&#34; then &#34;FRAUD&#34; else &#34;NO FRAUD&#34;" resultVariable="toolCallResult" />
      </bpmn:extensionElements>
    </bpmn:scriptTask>
    <bpmn:group id="Group_0yjli8o" categoryValueRef="CategoryValue_0ympg8h" />
    <bpmn:textAnnotation id="TextAnnotation_0ch3sx4">
      <bpmn:text>LLM as a judge</bpmn:text>
    </bpmn:textAnnotation>
    <bpmn:association id="Association_0lga9ob" associationDirection="None" sourceRef="TextAnnotation_0ch3sx4" targetRef="RunFinalCheck" />
    <bpmn:textAnnotation id="TextAnnotation_0yrffgq">
      <bpmn:text>Tool calling feedback loop</bpmn:text>
    </bpmn:textAnnotation>
    <bpmn:association id="Association_11mgikv" associationDirection="None" sourceRef="Flow_1dc12gc" targetRef="TextAnnotation_0yrffgq" />
    <bpmn:textAnnotation id="TextAnnotation_1umfv2v">
      <bpmn:text>LLM feedback loop</bpmn:text>
    </bpmn:textAnnotation>
    <bpmn:association id="Association_0abk3ku" associationDirection="None" sourceRef="Flow_1yea5o1" targetRef="TextAnnotation_1umfv2v" />
  </bpmn:process>
  <bpmn:escalation id="Escalation_3eekq60" name="FraudDetected" escalationCode="FraudDetected" />
  <bpmn:error id="Error_1vkip6r" name="Fraud Error" errorCode="Fraud_Error" />
  <bpmn:category id="Category_0wyof6z">
    <bpmn:categoryValue id="CategoryValue_0ympg8h" value="Parked" />
  </bpmn:category>
  <bpmndi:BPMNDiagram id="BPMNDiagram_1">
    <bpmndi:BPMNPlane id="BPMNPlane_1" bpmnElement="fraud-detection-process">
      <bpmndi:BPMNShape id="Activity_158b240_di" bpmnElement="Fraud_Tools" isExpanded="true">
        <dc:Bounds x="360" y="340" width="480" height="420" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_1rk6e27_di" bpmnElement="CallOnExternalAdvisor">
        <dc:Bounds x="420" y="500" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_02hr6cv_di" bpmnElement="FraudDetected">
        <dc:Bounds x="452" y="662" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="432" y="705" width="79" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_0pk8zb7_di" bpmnElement="EmailInquiry">
        <dc:Bounds x="420" y="380" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Gateway_04sl072_di" bpmnElement="Gateway_04sl072" isMarkerVisible="true">
        <dc:Bounds x="595" y="515" width="50" height="50" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="595" y="485" width="51" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_0ut60ps_di" bpmnElement="Event_0ut60ps">
        <dc:Bounds x="722" y="522" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="716" y="565" width="49" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_1vf3i1y_di" bpmnElement="Event_0gnk722">
        <dc:Bounds x="602" y="662" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="589" y="705" width="63" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_1oai29b_di" bpmnElement="Activity_087ozlu">
        <dc:Bounds x="710" y="380" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_18gj1i3_di" bpmnElement="Activity_1yge9uw">
        <dc:Bounds x="570" y="380" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="Flow_02dr109_di" bpmnElement="Flow_02dr109">
        <di:waypoint x="520" y="540" />
        <di:waypoint x="595" y="540" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1plqcas_di" bpmnElement="Flow_1plqcas">
        <di:waypoint x="488" y="680" />
        <di:waypoint x="602" y="680" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1y3onm8_di" bpmnElement="Flow_1y3onm8">
        <di:waypoint x="645" y="540" />
        <di:waypoint x="722" y="540" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="676" y="522" width="15" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1ex155v_di" bpmnElement="Flow_1ex155v">
        <di:waypoint x="620" y="565" />
        <di:waypoint x="620" y="662" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="626" y="611" width="18" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0uh3nkx_di" bpmnElement="Flow_0uh3nkx">
        <di:waypoint x="520" y="420" />
        <di:waypoint x="570" y="420" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_04fnx3s_di" bpmnElement="Flow_04fnx3s">
        <di:waypoint x="670" y="420" />
        <di:waypoint x="710" y="420" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="BPMNShape_1wybe8w" bpmnElement="RunFinalCheck">
        <dc:Bounds x="740" y="198" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Gateway_0y12zon_di" bpmnElement="Gateway_0y12zon" isMarkerVisible="true">
        <dc:Bounds x="895" y="213" width="50" height="50" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="881" y="270" width="79" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="_BPMNShape_StartEvent_2" bpmnElement="StartEvent_1">
        <dc:Bounds x="172" y="220" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="153" y="263" width="76" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_1sxkleb_di" bpmnElement="Event_1sxkleb">
        <dc:Bounds x="852" y="842" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="827" y="818" width="85" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Gateway_0cttbk8_di" bpmnElement="Gateway_0cttbk8" isMarkerVisible="true">
        <dc:Bounds x="255" y="213" width="50" height="50" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_0vgcvn8_di" bpmnElement="Event_0vgcvn8">
        <dc:Bounds x="1022" y="220" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1018" y="263" width="46" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_0xj2598_di" bpmnElement="FraudDetectionAgent" bioc:stroke="#205022" bioc:fill="#c8e6c9" color:background-color="#c8e6c9" color:border-color="#205022">
        <dc:Bounds x="360" y="198" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Gateway_0bukj01_di" bpmnElement="Gateway_0bukj01" isMarkerVisible="true">
        <dc:Bounds x="565" y="213" width="50" height="50" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="559" y="184" width="62" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_1levbiy_di" bpmnElement="Check_Fraud_Database">
        <dc:Bounds x="1210" y="580" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Group_0yjli8o_di" bpmnElement="Group_0yjli8o">
        <dc:Bounds x="1190" y="530" width="300" height="300" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1323" y="537" width="35" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="TextAnnotation_0ch3sx4_di" bpmnElement="TextAnnotation_0ch3sx4">
        <dc:Bounds x="790" y="110" width="100" height="26" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="TextAnnotation_0yrffgq_di" bpmnElement="TextAnnotation_0yrffgq">
        <dc:Bounds x="130" y="360" width="100" height="41" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="TextAnnotation_1umfv2v_di" bpmnElement="TextAnnotation_1umfv2v">
        <dc:Bounds x="130" y="102" width="100" height="41" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_0gvn82i_di" bpmnElement="Event_01me1b4">
        <dc:Bounds x="732" y="742" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="768" y="773" width="63" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="Flow_06y8gt9_di" bpmnElement="Flow_06y8gt9">
        <di:waypoint x="305" y="238" />
        <di:waypoint x="360" y="238" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0ifqrnr_di" bpmnElement="Flow_0ifqrnr">
        <di:waypoint x="208" y="238" />
        <di:waypoint x="255" y="238" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0nriff3_di" bpmnElement="Flow_0nriff3">
        <di:waypoint x="840" y="238" />
        <di:waypoint x="895" y="238" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0udscr6_di" bpmnElement="Flow_0udscr6">
        <di:waypoint x="750" y="778" />
        <di:waypoint x="750" y="860" />
        <di:waypoint x="852" y="860" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1yea5o1_di" bpmnElement="Flow_1yea5o1">
        <di:waypoint x="920" y="213" />
        <di:waypoint x="920" y="80" />
        <di:waypoint x="280" y="80" />
        <di:waypoint x="280" y="213" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="952" y="165" width="15" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1dqcrtw_di" bpmnElement="Flow_1dqcrtw">
        <di:waypoint x="945" y="238" />
        <di:waypoint x="1022" y="238" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="975" y="220" width="18" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_06sbwe8_di" bpmnElement="Flow_06sbwe8">
        <di:waypoint x="590" y="263" />
        <di:waypoint x="590" y="340" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_09px1dp_di" bpmnElement="Flow_09px1dp">
        <di:waypoint x="460" y="238" />
        <di:waypoint x="565" y="238" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1dc12gc_di" bpmnElement="Flow_1dc12gc">
        <di:waypoint x="360" y="410" />
        <di:waypoint x="280" y="410" />
        <di:waypoint x="280" y="263" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0fo3u1d_di" bpmnElement="Flow_0fo3u1d">
        <di:waypoint x="615" y="238" />
        <di:waypoint x="740" y="238" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Association_0lga9ob_di" bpmnElement="Association_0lga9ob">
        <di:waypoint x="837" y="136" />
        <di:waypoint x="798" y="198" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Association_11mgikv_di" bpmnElement="Association_11mgikv">
        <di:waypoint x="280" y="358" />
        <di:waypoint x="230" y="377" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Association_0abk3ku_di" bpmnElement="Association_0abk3ku">
        <di:waypoint x="280" y="160" />
        <di:waypoint x="230" y="140" />
      </bpmndi:BPMNEdge>
    </bpmndi:BPMNPlane>
  </bpmndi:BPMNDiagram>
</bpmn:definitions>
